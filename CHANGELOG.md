# Changelog

All notable changes to this project will be documented in this file.

## [Unreleased]
- Initial scaffold for Signal Search.
- Library data tools now surface bounded recent localStorage write-failure diagnostics (`signal-storage-write-failures-v1`) with clear controls, and `chat-app` persistence writes now run through quota/failure-aware guards to avoid unhandled storage exceptions.
- Added `check:smoke-fixtures` policy enforcement (`scripts/check-smoke-fixtures.mjs`) with tests and CI wiring so every `src/app/smoke-search/*` fixture route must be referenced by `scripts/smoke.mjs`.
- Added a zero-results smoke fixture route (`/smoke-search/zero-results`) plus smoke assertions that verify Unified Search recovery controls (`Clear operators`, `Reset type`, `Reset timeline`, `Reset verbatim`) remain rendered under constrained query/filter states.
- Added `check:project-memory` policy enforcement (`scripts/check-project-memory.mjs`) with tests and CI wiring so `PROJECT_MEMORY.md` verification entries must end with explicit `pass`/`fail` status tokens.
- Added keyboard regression coverage for operator-to-result precedence crossover when operator suggestions disappear, locking Arrow/Enter fallback behavior.
- Added malformed-NDJSON resilience coverage for streaming answers: `/api/answer/stream` now supports a smoke-only corrupt-chunk fixture toggle, the chat client tolerates isolated malformed NDJSON lines up to a bounded threshold, and smoke/route tests assert streams still reach a final `done` payload.
- Added shared bootstrap selected-thread id sanitization helper coverage (`trim`/`dedupe`/non-string drop) to lock deterministic smoke bootstrap behavior.
- Added `check:operator-docs` guardrail (`scripts/check-operator-docs.mjs`) plus CI wiring and tests to ensure parser operator suggestions remain documented in `docs/unified-search-operators.md`.
- Unified Search now decodes malformed notes payloads before preload and focus/storage refreshes, preventing corrupt `signal-notes` shapes from crashing `note.trim()` preparation paths.
- Added regression coverage for `stripUnifiedSearchOperators` mixed unknown-token inputs (including quoted colon tokens) so known operators are stripped without dropping unknown free-text constraints.
- Added fixture-backed stale-selection smoke coverage at `/smoke-search/stale-selection`, including SSR assertions for `Prune stale` visibility and diagnostics invariants (`loaded >= matched >= visible`).
- Unified Search bootstrap now supports smoke-only `debugMode` and pre-seeded `selectedThreadIds` for deterministic SSR diagnostics/recovery assertions.
- Unified Search diagnostics cards now emit machine-readable `data-*` counters used by smoke checks for row/total consistency validation.
- Unified Search perf harness now supports JSON artifact output (`--json` / `SEARCH_PERF_JSON_OUTPUT`) and configurable median/p95 guardrails (`--max-median-ms`, `--max-p95-ms`).
- Added a saved-search roundtrip smoke scenario at `/smoke-search/saved-roundtrip` with assertions for persisted query/filter/sort/timeline/result-limit/verbatim state in mock-mode smoke checks.
- Unified Search saved-search cards now surface `verbatim:true|false` in card metadata for faster preset scanability.
- Unified Search sorting/top-k helpers now apply explicit input-order tie-breaks, preventing parity drift when relevance scores and fallback timestamps are equal.
- Added fixture-backed Unified Search smoke coverage via `/smoke-search` (env-gated) and smoke-script assertions for operator-filtered seeded results.
- Unified Search local persistence writes now use quota/failure-aware storage guards with user-visible feedback instead of silent failures.
- Unified Search input now links to operator guidance via `aria-describedby` for improved screen-reader discoverability.
- Unified Search keyboard state handling is extracted to a dedicated helper/hook module with precedence regression tests.
- Unified Search now supports diagnostics mode (`/search?debug=1`) with per-type loaded/matched/visible counts and filtered-out reason buckets.
- Unified Search now decodes malformed `signal-space-tags-v1` payloads with trim/dedupe guards before search preload refreshes.
- Unified Search operator-summary chips now dedupe repeated `tag:`/`is:` operators and render in canonical order.
- Unified Search now syncs shareable URL state (`q`, `type`, `sort`, `time`, `limit`, `verbatim`) with hydration-safe defaults and back/forward navigation.
- Unified Search now shows a zero-results recovery card with one-click resets for operators, type scope, timeline, and verbatim filters.
- Added URL-state parsing/building and operator-stripping helper coverage, plus diagnostics invariant tests that enforce `loaded >= matched >= visible`.
- Added Unified Search benchmark harness (`scripts/search-perf.mjs` + `tests/search-perf.bench.ts`) with reproducible 1k/5k/10k local dataset timings.
- Unified Search now guards recent query preload (`signal-unified-recent-v1`) with schema validation, normalization, dedupe, and deterministic capping.
- Unified Search now decodes malformed collections/files preload payloads (`signal-collections-v1`, `signal-files-v1`) with safe defaults and malformed-entry pruning.
- Unified Search operator docs now include explicit export semantics and keyboard precedence behavior.
- Unified Search now decodes malformed thread/space/task localStorage payloads through schema guards before preload/focus refresh, preventing `/search` crashes from invalid cached shapes.
- Unified Search timeline regression coverage now includes DST-offset timestamp cases and invalid mixed timestamp handling for bounded windows.
- Unified Search export builders now run through shared pure helpers for markdown/saved-search/CSV generation.
- Unified Search CSV exports now use deterministic full-cell escaping for commas/newlines/quotes.
- Unified Search accessibility pass: action controls now expose explicit labels and toast updates are announced via polite live regions.
- Workflow policy now enforces that `.github/workflows/smoke.yml` executes `npm run smoke:mock`.
- Unified Search now supports timeline windows (all, 24h, 7d, 30d).
- Unified Search now supports direct and bulk thread actions (favorite, pin, archive, and space assignment).
- Unified Search relevance improved: multi-word queries match across fields (phrase or tokenized all-term match), with field-weighted ranking and precomputed scores.
- Unified Search supports query operators (`type:`, `space:`, `tag:`, `has:`) with inline help.
- Unified Search shows “why this matched” badges on thread results (title/tags/space/note/citations/answer).
- Unified Search performance: UI uses top-k selection per section (avoids sorting full result sets on every keystroke); full ordering is computed only on export.
- Unified Search exports now use deterministic timestamps (`ISO + locale`) with invalid-date fallback guardrails.
- Unified Search markdown exports now include environment metadata (`locale`, `timeZone`, and `utcOffset`) for reproducible cross-machine evidence.
- Unified Search bulk actions now expose a `Prune stale` recovery control when selected thread ids are no longer present.
- Unified Search parser regression coverage expanded with long/duplicate/quoted/unbalanced operator-heavy query tests.
- Added `/` focus and `Esc` clear shortcuts for Library/Spaces/Collections search inputs.
- GitHub Actions workflows hardened: pinned action SHAs, Scorecard permission-safe config, and gated Release Please automation.
- Upgraded `vitest` toolchain to remediate moderate dependency advisories.
